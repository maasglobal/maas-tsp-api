{
  "openapi": "3.0.0",
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local server"
    }
  ],
  "info": {
    "version": "1.1.0",
    "title": "WhimApp TSP API",
    "description": "## Introduction\n\nThis is a API specification of REST endpoints that a Transport Service\nProvider (TSP) should implement to offer their services through the \n[Whim application](https://whimapp.com/).\n\n\nIt is written in machine readable \n[OpenAPI Specification](https://github.com/OAI/OpenAPI-Specification) format, \nso that API endpoints, validators and test clients can be generated from the\ndocumentation.\n\n### Download \n\n* OpenAPI Specification [JSON, single file document](./specs/booking.json)\n* OpenAPI Specification [YAML](./specs/booking.yml)\n\n## Terminology\n\n* **endpoint** Publically resolvable URL either managed by MaaS Global (Whim Backend API) or by TSP (Booking API).\n\n* **booking** Information about single leg during the customer trip, together with customer information and state.\n\n* **journey** Multi-leg trip which user plans via WhimApp.\n\n* **leg** Single trip which is performed by TSP. Booking created and contain the state of this trip.\n\n* **TSP** Transport service provider. MaaS Global partner which offers their services via WhimApp.\n\n* **route** One of the possible journey. To determine it, we call TSP booking options endpoint to get available offers.\n\n* **micromobility** Light vehicles such as electric scooters, shared bicycles and electric bicycles.\n\n* **WhimApp** Mobile application or similar which is used by Whim User to perform journeys. Collectively we treat all interaction from the point of WhimApp and user experience during the time user uses application.\n\n* **Whim backend** Caller of TSP API endpoints. WhimApp never calls TSP endpoints directly. All invocations are done from cloud-native infrastructure managed by MaaS Global.\n\n* **MaaS Global** MaaS Global is the world’s first true Mobility-as-a-Service (MaaS) operator with its award-winning Whim app, which provides users all city transport services in one app.\n\n## Versions\n\n### 1.0.0 Initial release (2018)\n\n**deprecated**\n  \n  * [OpenAPI Specification](specs/maas-v1.yml)\n  * [Documentation](?maas-v1.yml)\n  * [SwaggerUI](swagger-ui.html?urls.primaryName=maas-v1.yml)\n  * Source code [repository](https://github.com/maasglobal/maas-tsp-api/tree/v1.0)\n\n### 1.1.0 Latest version\n\n  * [OpenAPI Specification](specs/booking.json)\n  * [Documentation](?booking.json)\n  * [SwaggerUI](swagger-ui.html?urls.primaryName=booking.yml)\n  * Source code [repository](https://github.com/maasglobal/maas-tsp-api/)\n\n## Getting started\n\n### Running local documentation server\n\nTo run local documentation server, follow the instructions in the [GitHub repo](https://github.com/maasglobal/maas-tsp-api/)\n\n    git clone https://github.com/maasglobal/maas-tsp-api/\n    cd maas-tsp-api\n    npm install\n    npm start\n\nOpen your browser and navigate to http://localhost:3000\n\n> ⚠️ You can change port by specifying `PORT` env variable\n",
    "contact": {
      "name": "Maas Global Team",
      "email": "tech@maas.global",
      "url": "https://github.com/maasglobal/maas-tsp-api"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    },
    "x-logo": {
      "url": "assets/whim-logo.svg",
      "altText": "Whim logo",
      "href": "https://whimapp.com"
    }
  },
  "tags": [
    {
      "name": "Booking lifecycle",
      "description": "The following scenario explains the life-cycle of an individual journey\nfrom a TSP viewpoint. Whenever a new concept (such as an actor or action)\nis represented, it is imprinted in **bold**.\n\nThis scenario, with a few extra details is detailed in the process diagram\nbelow. It should be noted from the picture that MaaS more often acts as a\ncaller than a callee for Transport Service Provider. \n\nThe cases of how WhimApp interacts with TSP are depicted in \n[business process diagram](https://cawemo.com/embed/09a7739f-f8ce-4fe4-a5e5-a8f66ecedb8c)\n\n<html>\n  <iframe src=\"https://cawemo.com/embed/09a7739f-f8ce-4fe4-a5e5-a8f66ecedb8c\" \n    style=\"width: 100%; height:300px; border:1px solid #ccc\" allowfullscreen=\"allowfullscreen\">\n  </iframe>\n<html>\n\n## Booking explained\n\nBooking represented state about one leg of a journey, connected with TSP specific information and state.\n\nData model as specified by [JSON Schema](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/core/booking.json) allows representing information about any type of transport and state. To better understand how booking works, lets take a look at the basic states and essential parts of the booking data.\n\n### State\n\nBooking goes through multiple states during journey, here are most important states. Please see [Tracking booking](#section/Tracking-booking) on information how WhimApp and TSP exchange this information.\n\n| State | Description |\n|-----|------|\n| **RESERVED** | Booking created by calling [Create Booking](#operation/bookingCreate) endpoint. |\n| **CONFIRMED** | Booking confirmed, e.g. TAXI driver have accepted this order. We are waiting for this state update from TSP by periodically calling [Get Booking](#operation/bookingGet) or waiting for webhook invocation via [Update booking state](#operation/backendBookingReceive) endpoint invocation. |\n| **ARRIVED** | Not applicable for all modes of transportation. For TAXI means driver have arrived to the pickup point. We are waiting for this state update from TSP. |\n| **ACTIVATED** | Booking has started. For TAXI means TAXI has picked up the passenger. We are waiting for this state update from TSP |\n| **FINISHED** | Ride was completed. We are waiting for this state update from TSP. |\n| **CANCELLED** | Cancelled by user. Booking can be subject to a fee or/and not be refundable as specified by TSP in booking cancellation rules. |\n| **REJECTED** | Rejected by TSP. We can update with this state on **PENDING**, **RESERVED**, **CONFIRMED**, **ACTIVATED** state and show User message about the reason for rejection, as received from TSP. |\n\n### Structure\n\nSee examples for a [Create Booking](#operation/bookingCreate) or schema for [Booking create](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-create) to understand all available data in a booking.\n\nHere are the most essential parts of the booking data.\n\n| State | Required? | Description |\n|-----|------|------| \n| `leg.from` | Y | Pickup point with name, address and coordinates (lat, long) |\n| `leg.to` | N | Destination point with name, address and coordinates (lat, long) |\n| `leg.startTime` | N | Start time of a trip, may be in future. |\n| `leg.endTime` | N | End time of a trip, must be in future. |\n| `leg.mode` | Y | Requested mode of transportation, i.e. TAXI |\n| `customer` | Y | Customer information |\n| `state` | Y | State of the booking |\n| `meta` | Y | Information about TSP. Also contains driver for TAXI |\n| `tspId` | Y | TSP specifid ID for this booking |\n| `cost` | Y | Amount and currency this booking cost |\n\n## Planning a Route\n\n**User** **queries** for a **Route** with an address or latitude-logitude\npair from one place to another. WhimApp queries the route from a third party\n**Routing Engine** that contains the data for **TSP** routes. At this point\nWhimApp makes no queries to the TSP - it expects the Routing Engine contains \nvalid GTFS data for the TSP.\n\n> ⚠️ Routing and GTFS are used only if applicable for TSP provider. For example, for micromobility providers we don't use GTFS and route planning.\n\n**WhimApp** shows several possible **Plans**, each containing a valid\n**Route** with several **Legs** with a part of a route using a specific TSP.\n\n## Booking options\n\nTo determine available mobility services, WhimApp calls [Available options](#operation/bookingOptionsGet) endpoint. Depending on the TSP mode of transportation this endpoint returns available TAXIs or cars or bikes for the specified location. After User selection, one of the options are used to create a booking by calling [Create Booking](#operation/bookingCreate) endpoint.\n\n| Related API   | Related schemas | Examples | \n| --------- | --------- | ------ |\n| [Available options](#operation/bookingOptionsGet) | [tsp/booking-options-list](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-options-list) |  TAXI - [response](examples/taxi/booking-options-response.json) |\n\n## Creating a Booking\n\nUser browses through the plans and chooses to book a journey. For each Leg\nin the Plan Route, WhimApp creates a new booking by invoking corresponding endpoint in TSP.\n\nIt should be noted that the booking may be hours or days in\nadvance - a bit like in booking a hotel. The booking contains the\nindividual leg as the detailed travel plan for the TSP, as well as\ncustomer contact information.\n\n> ⚠️ Specific parts of customer information (E-mail, Phone, Last name, First name, ...etc) which are sent to the TSP are subject to agreement between MaaS Global and TSP.\n\nTSP receives the booking and confirms the trip. TSP may modify the details\nof the Booking, such as moving the **start location** to closest known\nstreet address or delaying the Leg **start time**, as long as the\n**end time** can be guaranteed. The Booking is supplemented with\n**booked** state information and additional **terms** such as\nthe latest **cancellation rules**.\n\nWhimApp checks that the creation of booking succeeded and stores the Booking for future\nreference.\n\n> ⚠️ User can also booking a trip directly for the TAXI, car or micromobility transport (which will result in a journey with one leg)\n\n| Related API   | Related schemas | Examples | \n| --------- | --------- | ------ |\n| [Create Booking](#operation/bookingCreate) | [tsp/booking-create](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-create) |  TAXI - [request](examples/taxi/booking-create-request.json), [response](examples/taxi/booking-create-response.json) |\n\n## Paying a Booking\n\nWhen booking created it is already paid according to the options received and selected by User. See [Booking options](#section/Booking+options) for more information.\n\nIf booking can not be created the paid amount will be refunded to the User.\n\n## Navigating a Route\n\nUser starts to navigate the Route. WhimApp tracks for the user location to\nknow if there are any changes needed in the plan. WhimApp triggers the changes\nfor bookings by monitoring the individual legs.\n\nWhimApp monitors the Booking terms and Leg **start time**.\nWhen the actual Leg starts, WhimApp **starts** the Leg and notifies the TSP.\nUser or TSP may request changes to the Booking, e.g. in a case of a delay\nor cancellation.\n\nEach of these scenarios are described below.\n\n## Updating a Booking\n\nA Booking may be updated by a User or WhimApp when any party receives\nnew information that the Leg needs to be changed. For example when User wants \nto change a destination. Such change may be subject to a fee, which should be \nreflected in a response to update or when new booking retrieved via \n[Get booking](#operation/bookingGet) endpoint.\n\n| Related API   | Related schemas | Examples | \n| --------- | --------- | ------ |\n| [Update Booking](#operation/bookingUpdate) | [tsp/booking-update](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-update) |  - |\n\n## Cancelling a Booking\n\nA Booking may be cancelled by User or WhimApp as specified by **cancellation rules** in\n**terms** of the Booking. WhimApp invokes a [Cancel booking](#operation/bookingCancel) endpoint. \nTSP confirms and updates its own systems. If TSP can not cancel booking it \n\nIt should be noted that cancellation is an exception case and is likely\nhappen only when the user chooses to cancel the whole route Plan.\n\n| Related API   | Related schemas | Examples | \n| --------- | --------- | ------ |\n| [Cancel Booking](#operation/bookingCancel) | [tsp/booking-cancel](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-cancel) |  - |\n\n## Tracking booking\n\nTo provide smooth user experience it is very important to keep booking state updated on the WhimApp side.\nTo do this we can use two approaches:\n\n* We periodically check booking state, by calling [Get booking](#operation/bookingGet) endpoint\n* TSP sends us latest update, by calling Whim Backend endpoint [Update booking state](#operation/backendBookingReceive)\n\nWhile the latter are preferred way, MVP implementation can be created by only providing **required** [Get booking](#operation/bookingGet) endpoint.\n\n| Related API   | Related schemas | Examples | \n| --------- | --------- | ------ |\n| [Get Booking](#operation/bookingGet) | [tsp/booking-read-by-id](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-read-by-id) | TAXI - [RESERVED](examples/taxi/booking-read-by-id-response.json), [ACTIVATED](examples/taxi/booking-read-by-id-response-activated.json) |\n| [Update booking state](#operation/backendBookingReceive) | [tsp/booking-read-by-id](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-read-by-id) | - |\n\n## Error Cases\n\nIt may be possible that WhimApp sends an invalid request or the TSP cannot\nfulfill a request. In any such case, TSP may respond with an error. If\nTSP responds with an error, WhimApp assumes the state was not changed (e.g.\na transaction was rolled back). WhimApp may repeat the request\nwith the same or different data later on.\n\nThe same principle applies when TSP is communicating with WhimApp.\n",
      "x-traitTag": true
    },
    {
      "name": "Booking",
      "description": "Booking related APIs are the core of a TSP implementation.\n\nCorrespondingly, a Booking is the main object exchanged between WhimApp and a\nTSP. For more information about booking, see [Booking explained](#section/Booking-explained)\n",
      "x-traitTag": false,
      "x-displayName": "Booking API"
    },
    {
      "name": "WebHook",
      "description": "Publically available API which you can call to send booking state changes immediately when they\nhappen, without the need to for us to poll our system by calling [Get booking](#operation/bookingGet) multiple times.\n\nThis endpoinds are treated as Webhooks which you **may** call to make communication faster and booking process smoother.\n\n> ⚠️ The specific endpoing URL to be invoked are subject to aggreement between TSP and MaaS Global.\n",
      "x-traitTag": false,
      "x-displayName": "Whim Backend API"
    },
    {
      "name": "Support",
      "description": "We would like to help you with code and other questions you might have.\n\nSearch our documentation, contact our [tech team](mailto:tech@maas.global), or connect with our [sales team](https://whimapp.com/partners/).\n\n### Improving documentation\n\nIt would be great if you have anything to contribute to our documentation, \nyou can do it by creating a fork and issuing a pull-request.\n\nOr you can file an [issue](https://github.com/maasglobal/maas-tsp-api/issues) \nif you discover some problem or invalid information.\n\nYou also can reach team via tech@maas.global\n",
      "x-traitTag": true,
      "x-displayName": "Support"
    }
  ],
  "components": {
    "securitySchemes": {
      "apiKeyHeader": {
        "in": "header",
        "name": "X-API-Key",
        "type": "apiKey",
        "description": "Authorization scheme to use with TSP API should be based on specifying `X-API-Key`\nheader when WhimApp makes request to the TSP API.\n\n\n*Please note* what due to serverless nature of our infrastructure we are unable to provide\nyou with a set of IP addresses HTTP request will be originating from.\n"
      }
    }
  },
  "security": [
    {
      "apiKeyHeader": []
    }
  ],
  "paths": {
    "/bookings/options": {
      "get": {
        "operationId": "bookingOptionsGet",
        "summary": "Available options",
        "description": "Returns available options or offers.\n\nThe options are used to construct a booking to be created after User selects it by calling [Create booking](#operation/bookingCreate).\n\nFull schema for parameters defined in [maas-schemas](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-options-list/request.json) project\n",
        "tags": [
          "Booking"
        ],
        "parameters": [
          {
            "name": "from",
            "description": "User's location in comma separated form e.g. 60.123,27.456",
            "in": "query",
            "required": true,
            "schema": {
              "description": "Geographic latitude-longitude number-pair as a string in WGS-84 system, see https://en.wikipedia.org/wiki/World_Geodetic_System",
              "type": "string",
              "pattern": "^[+-]?\\d{1,3}(\\.\\d+)?,[+-]?\\d{1,3}(\\.\\d+)?$",
              "minLength": 1,
              "maxLength": 64
            }
          },
          {
            "name": "to",
            "description": "A desired destination e.g. 60.123,27.456",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/paths/~1bookings~1options/get/parameters/0/schema"
            }
          },
          {
            "name": "startTime",
            "description": "Start journey time",
            "in": "query",
            "required": true,
            "schema": {
              "description": "POSIX time in milliseconds, https://en.wikipedia.org/wiki/Unix_time",
              "type": "integer",
              "maximum": 9007199254740991,
              "minimum": 1451606400
            }
          },
          {
            "name": "endTime",
            "description": "End journey time",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
            }
          },
          {
            "name": "mode",
            "description": "Transfer mode",
            "in": "query",
            "required": false,
            "schema": {
              "$id": "http://maasglobal.com/core/components/travel-mode.json",
              "description": "Transfer modes used for MaaS internal services",
              "anyOf": [
                {
                  "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/waitingMode"
                },
                {
                  "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/transferMode"
                },
                {
                  "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/personalMode"
                },
                {
                  "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/publicTransitMode"
                },
                {
                  "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/privateTransitMode"
                }
              ],
              "definitions": {
                "waitingMode": {
                  "description": "A mode that only involves waiting in the current location",
                  "type": "string",
                  "enum": [
                    "WAIT"
                  ]
                },
                "transferMode": {
                  "description": "A mode that involves changing transports",
                  "type": "string",
                  "enum": [
                    "LEG_SWITCH",
                    "TRANSFER"
                  ]
                },
                "personalMode": {
                  "description": "A mode that involves using your personal vehicle or legs",
                  "type": "string",
                  "enum": [
                    "BICYCLE",
                    "CAR",
                    "SCOOTER",
                    "SHARED_BICYCLE",
                    "WALK"
                  ]
                },
                "publicTransitMode": {
                  "description": "A mode that involves transit with fixed schedules",
                  "type": "string",
                  "enum": [
                    "AEROPLANE",
                    "BUS",
                    "FERRY",
                    "RAIL",
                    "SUBWAY",
                    "TRAIN",
                    "TRAM",
                    "TRANSIT"
                  ]
                },
                "privateTransitMode": {
                  "description": "A mode that is available on-demand for your personal use",
                  "type": "string",
                  "enum": [
                    "BUSISH",
                    "CABLE_CAR",
                    "CAR",
                    "FUNICULAR",
                    "GONDOLA",
                    "SHARED_CAR",
                    "TAXI",
                    "TRAINISH"
                  ]
                }
              }
            }
          }
        ],
        "x-code-samples": [
          {
            "lang": "Shell",
            "label": "Query for taxi",
            "source": "curl --location --request GET 'http://localhost:3000/bookings/options? \\\n  customer[clientId]=whim&customer[locale]=en& \\\n  customer[opaqueId]=deadbeef-deadbeef& \\\n  customer[phone]=+35840000000& \\\n  distance=9734&endTime=1572347575000& \\\n  from=60.1769789,24.9504135& \\\n  fromAddress=streetName:Siltasaarenkatu|streetNumber:1|city:Helsinki|zipCode:00530|country:Suomi&fromName=Siltasaarenkatu%201%20Helsinki& \\\n  mode=TAXI& \\\n  startTime=1572347575000& \\\n  to=60.23044350000001,24.8990183& \\\n  toAddress=streetName:Ida%20Aalbergin%20tie|streetNumber:3|city:Helsinki|zipCode:00400|country:Suomi& \\\n  toName=Ida%20Aalbergin%20tie%203%20Helsinki' \\\n    --header \"x-api-key: pieY8Oezeicioyei5eisheeb7sheeLie\"\n"
          }
        ],
        "responses": {
          "200": {
            "x-summary": "Array of options",
            "description": "Available transport options matching the given query parameters. If\nno transport options are available, an empty array is returned.\n",
            "content": {
              "application/json": {
                "schema": {
                  "$id": "http://maasglobal.com/tsp/bookings-options-list/response.json",
                  "description": "Response schema for getting options from a TSP adapter",
                  "type": "object",
                  "properties": {
                    "options": {
                      "type": "array",
                      "items": {
                        "$id": "http://maasglobal.com/core/booking-option.json",
                        "description": "MaaS single TSP adapter option",
                        "oneOf": [
                          {
                            "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/contentWithCost"
                          },
                          {
                            "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/contentWithConfigurator"
                          }
                        ],
                        "definitions": {
                          "contentWithCost": {
                            "type": "object",
                            "required": [
                              "leg",
                              "meta",
                              "terms",
                              "tspProduct",
                              "cost"
                            ],
                            "properties": {
                              "leg": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/leg"
                              },
                              "terms": {
                                "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                              },
                              "meta": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta"
                              },
                              "tspProduct": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                              },
                              "cost": {
                                "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                              },
                              "customer": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/customer"
                              }
                            }
                          },
                          "contentWithConfigurator": {
                            "type": "object",
                            "required": [
                              "leg",
                              "meta",
                              "terms",
                              "tspProduct",
                              "configurator"
                            ],
                            "properties": {
                              "leg": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/leg"
                              },
                              "terms": {
                                "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                              },
                              "meta": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta"
                              },
                              "tspProduct": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                              },
                              "configurator": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator"
                              },
                              "customer": {
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/customer"
                              }
                            }
                          },
                          "customer": {
                            "description": "MaaS booking customer",
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customer"
                          },
                          "leg": {
                            "type": "object",
                            "description": "A subset of the standard leg (../core/leg.json)",
                            "properties": {
                              "mode": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema"
                              },
                              "startTime": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                              },
                              "endTime": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                              },
                              "from": {
                                "description": "Starting location's lat and lon pair of this request",
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              },
                              "to": {
                                "$id": "http://maasglobal.com/core/components/place.json",
                                "description": "A place, as a location-name pair with name and address",
                                "type": "object",
                                "additionalProperties": true,
                                "allOf": [
                                  {
                                    "description": "No-numeric precision version of MaaS core location",
                                    "type": "object",
                                    "properties": {
                                      "lat": {
                                        "description": "No-numeric precision version of MaaS core latitude",
                                        "type": "number",
                                        "minimum": -90,
                                        "maximum": 90
                                      },
                                      "lon": {
                                        "description": "No-numeric precision version of MaaS core longitude",
                                        "type": "number",
                                        "minimum": -180,
                                        "maximum": 180
                                      }
                                    },
                                    "required": [
                                      "lat",
                                      "lon"
                                    ]
                                  },
                                  {
                                    "type": "object",
                                    "additionalProperties": true,
                                    "properties": {
                                      "name": {
                                        "description": "Place name (given in autocomplete)",
                                        "type": "string",
                                        "minLength": 1
                                      },
                                      "address": {
                                        "description": "Encoded address components in form country:Finland|state:Uusimaa|city:Helsinki|zipCode:00100|streetName:Ludviginkatu|streetNumber:6",
                                        "type": "string",
                                        "pattern": "^(?:(?:(?:country:(?:\\p{L}|\\s|')+)|(?:state:(?:\\p{L}|[,\\.:\\-`'´\\s])+)|(?:city:(?:\\p{L}|[,\\.:\\-`'´\\s])+)|(?:zipCode:(?:[a-zA-Z0-9 ]{3,10}|(?:\\p{L}|\\d){2,4}(\\s(?:\\p{L}|\\d){2,4})?))|(?:streetName:[^|]+)|(?:streetNumber:\\d+))\\|?){4,6}$"
                                      },
                                      "localeAddress": {
                                        "type": "string",
                                        "description": "Country specific formatted address"
                                      },
                                      "stopId": {
                                        "type": "string",
                                        "minLength": 1,
                                        "maxLength": 64
                                      },
                                      "stopCode": {
                                        "type": "string",
                                        "minLength": 1,
                                        "maxLength": 64
                                      },
                                      "stationId": {
                                        "type": "string",
                                        "minLength": 1,
                                        "maxLength": 64
                                      },
                                      "facilities": {
                                        "type": "array",
                                        "items": {
                                          "type": "string",
                                          "minLength": 1,
                                          "maxLength": 80
                                        }
                                      },
                                      "openingHours": {
                                        "description": "Opening hour of the station, object format is left for TSP to decide",
                                        "type": "object"
                                      },
                                      "zone": {
                                        "description": "Geofencing zone defined by provider that the station is within",
                                        "anyOf": [
                                          {
                                            "type": "number"
                                          },
                                          {
                                            "type": "string"
                                          }
                                        ]
                                      }
                                    }
                                  }
                                ],
                                "required": [
                                  "lat",
                                  "lon"
                                ]
                              },
                              "departureDelay": {
                                "description": "duration in milliseconds (negative values permitted), https://en.wikipedia.org/wiki/Unix_time",
                                "type": "integer",
                                "maximum": 9007199254740991,
                                "minimum": -9007199254740991
                              },
                              "agencyId": {
                                "type": "string",
                                "minLength": 2,
                                "maxLength": 64
                              }
                            },
                            "additionalProperties": false,
                            "required": [
                              "mode",
                              "startTime",
                              "endTime",
                              "from",
                              "to"
                            ]
                          },
                          "legDelta": {
                            "type": "object",
                            "description": "A leg delta, containing any subset of the valid properties",
                            "properties": {
                              "mode": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema"
                              },
                              "startTime": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                              },
                              "endTime": {
                                "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                              },
                              "departureDelay": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/departureDelay"
                              },
                              "from": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              },
                              "to": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              }
                            },
                            "additionalProperties": false
                          },
                          "tspProduct": {
                            "description": "Defines what kind of TSP product the booking option represents.",
                            "type": "object",
                            "properties": {
                              "id": {
                                "description": "Unique identifier for the product",
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 255
                              }
                            },
                            "required": [
                              "id"
                            ],
                            "additionalProperties": false
                          }
                        }
                      }
                    },
                    "additional": {
                      "type": "object",
                      "properties": {
                        "bikeStations": {
                          "type": "array",
                          "items": {
                            "$id": "http://maasglobal.com/core/components/bike-station.json",
                            "description": "MaaS bike station schema",
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "location": {
                                "description": "Geographic latitude-longitude object in WGS-84 system, see https://en.wikipedia.org/wiki/World_Geodetic_System",
                                "type": "object",
                                "properties": {
                                  "lat": {
                                    "description": "Geographic latitude (north-south axis) in WGS-84 system, see https://en.wikipedia.org/wiki/World_Geodetic_System",
                                    "type": "number",
                                    "minimum": -90,
                                    "maximum": 90
                                  },
                                  "lon": {
                                    "description": "Geographic longitude (east-west axis) in WGS-84 system, see https://en.wikipedia.org/wiki/World_Geodetic_System",
                                    "type": "number",
                                    "minimum": -180,
                                    "maximum": 180
                                  }
                                },
                                "required": [
                                  "lat",
                                  "lon"
                                ]
                              },
                              "slots": {
                                "type": "object",
                                "properties": {
                                  "total": {
                                    "type": "number",
                                    "minimum": 0
                                  },
                                  "empty": {
                                    "type": "number",
                                    "minimum": 0
                                  },
                                  "bikes": {
                                    "type": "number",
                                    "minimum": 0
                                  }
                                },
                                "required": [
                                  "total",
                                  "empty",
                                  "bikes"
                                ]
                              }
                            },
                            "required": [
                              "id",
                              "name",
                              "location"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "required": [
                    "options"
                  ],
                  "additionalProperties": false
                },
                "examples": {
                  "Taxi": {
                    "summary": "Taxi",
                    "externalValue": "../examples/taxi/booking-options-response.json"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/bookings": {
      "post": {
        "operationId": "bookingCreate",
        "summary": "Create booking",
        "description": "Creates a new `Booking` for the TSP in **RESERVED** state. The returned\nobject will be a reference that is passed back & forth throughout the\nbooking lifecycle.\n\nBooking request are based upon the response returned by calling [Available options](#operation/bookingOptionsGet) endpoint.\n\nThe Booking may be modified in the response, e.g. location being\nadjusted for a more suitable pick-up location.\n\nIn addition, the service may contain a **meta** attribute for arbitrary\nTSP metadata that the TSP needs later, and **token** attribute depicting\nhow long the current state is valid.\n\n### JSON Schema documentation\n\nFull schema for parameters defined in [maas-schemas](https://github.com/maasglobal/maas-schemas/blob/develop/maas-schemas/schemas/tsp/booking-create/request.json) project\n",
        "tags": [
          "Booking"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$id": "http://maasglobal.com/tsp/bookings-create/request.json",
                "description": "Request schema for creating a booking through a TSP adapter",
                "type": "object",
                "properties": {
                  "leg": {
                    "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/leg"
                  },
                  "meta": {
                    "$id": "http://maasglobal.com/core/booking-meta.json",
                    "description": "TSP/mode-specific additional information. The TSP adapter should set MODE_{mode} with defined data, otherwise 'meta' can be used freely.",
                    "type": "object",
                    "properties": {
                      "MODE_WALK": {
                        "$id": "http://maasglobal.com/core/modes/MODE_WALK.json",
                        "description": "Schema for MODE_WALK meta field",
                        "type": "object"
                      },
                      "MODE_BICYCLE": {
                        "$id": "http://maasglobal.com/core/modes/MODE_BICYCLE.json",
                        "type": "object",
                        "properties": {
                          "pickupStation": {
                            "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/additional/properties/bikeStations/items"
                          },
                          "returnStation": {
                            "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/additional/properties/bikeStations/items"
                          },
                          "pickupStationId": {
                            "type": "string"
                          },
                          "returnStationId": {
                            "type": "string"
                          },
                          "bike": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id"
                            ]
                          }
                        }
                      },
                      "MODE_CAR": {
                        "$id": "http://maasglobal.com/core/modes/MODE_CAR.json",
                        "description": "Schemas for MODE_CAR meta field",
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "name": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "description": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "image": {
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/driver/properties/image"
                          },
                          "terms": {},
                          "car": {
                            "type": "object",
                            "properties": {
                              "passengers": {
                                "description": "The number of passengers this vehicle will be able to transport",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 200
                              },
                              "doors": {
                                "description": "The number of doors this car model may have - an array of min & max",
                                "type": "array",
                                "items": {
                                  "type": "integer",
                                  "minimum": 0,
                                  "maximum": 10
                                },
                                "minItems": 2,
                                "maxItems": 2
                              },
                              "luggage": {
                                "description": "The number of luggage this vehicle will be able to transport - an array of [big, small] luggage",
                                "type": "array",
                                "items": {
                                  "type": "integer",
                                  "minimum": 0,
                                  "maximum": 200
                                },
                                "minItems": 2,
                                "maxItems": 2
                              },
                              "transmission": {
                                "enum": [
                                  "manual",
                                  "automatic",
                                  null
                                ]
                              },
                              "fuel": {
                                "enum": [
                                  "diesel",
                                  "electric",
                                  "ethanol",
                                  "gasoline",
                                  "hybrid",
                                  "hydrogen",
                                  "lpg",
                                  "multifuel",
                                  null
                                ]
                              },
                              "classification": {
                                "oneOf": [
                                  {
                                    "$id": "http://maasglobal.com/core/components/ACRISS.json",
                                    "description": "ACRISS classification of the car, see https://en.wikipedia.org/wiki/ACRISS_Car_Classification_Code",
                                    "type": "string",
                                    "pattern": "[MNEHCDIJSRFGPULWOX][BCDWVLSTFJXPQZEMRHYNGK][MNCABD][RNDQHIECLSABMFVZUX]"
                                  },
                                  {
                                    "type": "null"
                                  }
                                ]
                              },
                              "registrationPlate": {
                                "description": "Registration plate (e.g. if we know the actual car already)",
                                "type": "string",
                                "pattern": "[A-Z\\-0-9]"
                              },
                              "damage": {
                                "description": "Any reported damages to the car (if available)",
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 255
                              },
                              "fuelLevel": {
                                "description": "The percentage of fuel the car has at the moment",
                                "type": "number",
                                "minLength": 0,
                                "maxLength": 100
                              },
                              "location": {
                                "description": "Current geo location",
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/additional/properties/bikeStations/items/properties/location"
                              }
                            },
                            "required": [
                              "classification"
                            ]
                          },
                          "pickupInfo": {
                            "description": "Pickup instructions in HTML format",
                            "type": "string"
                          },
                          "returnInfo": {
                            "description": "Return Instructions in HTML format",
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_CAR/properties/pickupInfo"
                          },
                          "startEndGeoRegionUrl": {
                            "description": "Region in which car can be rented and returned. Url to GeoJSON file",
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/driver/properties/image"
                          }
                        },
                        "required": [
                          "name",
                          "description",
                          "image"
                        ],
                        "additionalProperties": false
                      },
                      "MODE_TRAM": {
                        "$id": "http://maasglobal.com/core/modes/MODE_TRAM.json",
                        "description": "Schema for MODE_TRAM meta field",
                        "type": "object"
                      },
                      "MODE_SUBWAY": {
                        "$id": "http://maasglobal.com/core/modes/MODE_SUBWAY.json",
                        "description": "Schema for MODE_SUBWAY meta field",
                        "type": "object"
                      },
                      "MODE_RAIL": {
                        "$id": "http://maasglobal.com/core/modes/MODE_RAIL.json",
                        "description": "Schema for MODE_RAIL meta field",
                        "type": "object",
                        "properties": {
                          "outward": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "description": "Arbitrary outward journey id given by either TSP or map provider",
                                "type": "string"
                              },
                              "from": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              },
                              "to": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              }
                            },
                            "required": [
                              "from",
                              "to"
                            ]
                          },
                          "return": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "description": "Arbitrary return journey id given by either TSP or map provider",
                                "type": "string"
                              },
                              "from": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              },
                              "to": {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              }
                            },
                            "required": [
                              "from",
                              "to"
                            ]
                          },
                          "deliveryMethod": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "stationId": {
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 64
                              },
                              "alternativeCollections": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      },
                      "MODE_BUS": {
                        "$id": "http://maasglobal.com/core/modes/MODE_BUS.json",
                        "description": "Schema for MODE_BUS meta field",
                        "type": "object"
                      },
                      "MODE_FERRY": {
                        "$id": "http://maasglobal.com/core/modes/MODE_FERRY.json",
                        "description": "Schema for MODE_FERRY meta field",
                        "type": "object"
                      },
                      "MODE_CABLE_CAR": {
                        "$id": "http://maasglobal.com/core/modes/MODE_CABLE_CAR.json",
                        "description": "Schema for MODE_CABLE_CAR meta field",
                        "type": "object"
                      },
                      "MODE_GONDOLA": {
                        "$id": "http://maasglobal.com/core/modes/MODE_GONDOLA.json",
                        "description": "Schema for MODE_GONDOLA meta field",
                        "type": "object"
                      },
                      "MODE_FUNICULAR": {
                        "$id": "http://maasglobal.com/core/modes/MODE_FUNICULAR.json",
                        "description": "Schema for MODE_FUNICULAR meta field",
                        "type": "object"
                      },
                      "MODE_SHARED_BICYCLE": {
                        "$id": "http://maasglobal.com/core/modes/MODE_SHARED_BICYCLE.json",
                        "type": "object",
                        "properties": {
                          "bike": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id"
                            ]
                          }
                        }
                      },
                      "MODE_SHARED_CAR": {
                        "$id": "http://maasglobal.com/core/modes/MODE_SHARED_CAR.json",
                        "description": "Schemas for MODE_SHARED_CAR meta field",
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "name": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "description": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "image": {
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/driver/properties/image"
                          },
                          "terms": {},
                          "car": {
                            "type": "object",
                            "properties": {
                              "passengers": {
                                "description": "The number of passengers this vehicle will be able to transport",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 200
                              },
                              "doors": {
                                "description": "The number of doors this car model may have - an array of min & max",
                                "type": "array",
                                "items": {
                                  "type": "integer",
                                  "minimum": 0,
                                  "maximum": 10
                                },
                                "minItems": 2,
                                "maxItems": 2
                              },
                              "luggage": {
                                "description": "The number of luggage this vehicle will be able to transport - an array of [big, small] luggage",
                                "type": "array",
                                "items": {
                                  "type": "integer",
                                  "minimum": 0,
                                  "maximum": 200
                                },
                                "minItems": 2,
                                "maxItems": 2
                              },
                              "transmission": {
                                "enum": [
                                  "manual",
                                  "automatic",
                                  null
                                ]
                              },
                              "fuel": {
                                "enum": [
                                  "diesel",
                                  "electric",
                                  "ethanol",
                                  "gasoline",
                                  "hybrid",
                                  "hydrogen",
                                  "lpg",
                                  "multifuel",
                                  null
                                ]
                              },
                              "classification": {
                                "oneOf": [
                                  {
                                    "$id": "http://maasglobal.com/core/components/ACRISS.json",
                                    "description": "ACRISS classification of the car, see https://en.wikipedia.org/wiki/ACRISS_Car_Classification_Code",
                                    "type": "string",
                                    "pattern": "[MNEHCDIJSRFGPULWOX][BCDWVLSTFJXPQZEMRHYNGK][MNCABD][RNDQHIECLSABMFVZUX]"
                                  },
                                  {
                                    "type": "null"
                                  }
                                ]
                              },
                              "registrationPlate": {
                                "description": "Registration plate (e.g. if we know the actual car already)",
                                "type": "string",
                                "pattern": "[A-Z\\-0-9]"
                              },
                              "damage": {
                                "description": "Any reported damages to the car (if available)",
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 255
                              },
                              "fuelLevel": {
                                "description": "The percentage of fuel the car has at the moment",
                                "type": "number",
                                "minLength": 0,
                                "maxLength": 100
                              },
                              "location": {
                                "description": "Current geo location",
                                "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/additional/properties/bikeStations/items/properties/location"
                              }
                            },
                            "required": [
                              "classification"
                            ]
                          },
                          "pickupInfo": {
                            "description": "Pickup instructions in HTML format",
                            "type": "string"
                          },
                          "returnInfo": {
                            "description": "Return Instructions in HTML format",
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_CAR/properties/pickupInfo"
                          },
                          "startEndGeoRegionUrl": {
                            "description": "Region in which car can be rented and returned. Url to GeoJSON file",
                            "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/driver/properties/image"
                          }
                        },
                        "required": [
                          "name",
                          "description",
                          "image"
                        ],
                        "additionalProperties": false
                      },
                      "MODE_TRANSIT": {
                        "$id": "http://maasglobal.com/core/modes/MODE_TRANSIT.json",
                        "description": "Schema for MODE_TRANSIT meta field",
                        "type": "object"
                      },
                      "MODE_TRAIN": {
                        "$id": "http://maasglobal.com/core/modes/MODE_TRAIN.json",
                        "description": "Schema for MODE_TRAIN meta field",
                        "type": "object"
                      },
                      "MODE_TRAINISH": {
                        "$id": "http://maasglobal.com/core/modes/MODE_TRAINISH.json",
                        "description": "Schema for MODE_TRAINISH meta field",
                        "type": "object"
                      },
                      "MODE_BUSISH": {
                        "$id": "http://maasglobal.com/core/modes/MODE_BUSISH.json",
                        "description": "Schema for MODE_BUSISH meta field",
                        "type": "object"
                      },
                      "MODE_TAXI": {
                        "$id": "http://maasglobal.com/core/modes/MODE_TAXI.json",
                        "description": "Schema for MODE_TAXI meta field",
                        "type": "object",
                        "properties": {
                          "vehicleId": {
                            "description": "The taxi id (in the taxi number plate on top of the vehicle)",
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "vehicleLocation": {
                            "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/additional/properties/bikeStations/items/properties/location"
                          },
                          "vehicleType": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "vehicleDescription": {
                            "description": "An arbitrary description of the vehicle, e.g. 'Black Jaguar'",
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 256
                          },
                          "driver": {
                            "description": "Driver information",
                            "type": "object",
                            "properties": {
                              "phone": {
                                "type": "string"
                              },
                              "name": {
                                "description": "Driver name, e.g. 'Sergey' or 'Jane S.'",
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 128
                              },
                              "image": {
                                "description": "Uniform resource locator, see https://en.wikipedia.org/wiki/Uniform_Resource_Locator and https://mathiasbynens.be/demo/url-regex",
                                "type": "string",
                                "pattern": "^(https?|ftp):\\/\\/[^\\s/$.?#].[^\\s]*$"
                              }
                            }
                          },
                          "dispatchOrderId": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 128
                          },
                          "eta": {
                            "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                          },
                          "taxiCenter": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "minLength": 1,
                                "maxLength": 64
                              },
                              "phone": {
                                "description": "ITU-T E.164 phone number, see https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s03.html",
                                "type": "string",
                                "pattern": "^\\+(?:\\d){6,14}\\d$"
                              }
                            }
                          }
                        },
                        "additionalProperties": false
                      },
                      "MODE_SCOOTER": {
                        "$id": "http://maasglobal.com/core/modes/MODE_SCOOTER.json",
                        "type": "object",
                        "properties": {
                          "scooter": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "id"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "terms": {
                    "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                  },
                  "customer": {
                    "$id": "http://maasglobal.com/core/customer.json",
                    "description": "MaaS customer schema",
                    "type": "object",
                    "properties": {
                      "identityId": {
                        "anyOf": [
                          {
                            "type": "string",
                            "pattern": "^[aepus]{2}-[\\w]{4}-\\d:[a-f\\d]{8}(-[a-f\\d]{4}){3}-[a-f\\d]{12}$"
                          },
                          {
                            "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/id"
                          }
                        ]
                      },
                      "firstName": {
                        "description": "First name of the customer (e.g. John)",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customer/properties/lastName"
                      },
                      "lastName": {
                        "description": "Last name of the customer (e.g. Doe)",
                        "type": "string",
                        "pattern": "^(?:\\p{L})+(?:[`'´\\-\\.,]?\\s?(?:\\p{L})*)*$",
                        "maxLength": 255
                      },
                      "phone": {
                        "description": "ITU-T E.164 phone number",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/taxiCenter/properties/phone"
                      },
                      "email": {
                        "description": "Rough validation of a valid e-mail address",
                        "type": "string",
                        "pattern": "^.+@.+\\..+$",
                        "maxLength": 64
                      },
                      "address": {
                        "description": "Street address (and optional number), http://www.bitboost.com/ref/international-address-formats.html",
                        "type": "string",
                        "minLength": 2
                      },
                      "city": {
                        "description": "Alphabetic city name",
                        "type": "string",
                        "minLength": 1
                      },
                      "country": {
                        "description": "ISO 3166-1 alpha-2 country code, see https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2",
                        "type": "string",
                        "pattern": "^[A-Z]{2,2}$"
                      },
                      "zipCode": {
                        "description": "Numeric zip code, see https://en.wikipedia.org/wiki/Postal_code",
                        "type": "string",
                        "minLength": 2,
                        "maxLength": 64
                      },
                      "locale": {
                        "type": "string",
                        "pattern": "^[a-z]{2,3}(?:-[a-zA-Z]{4})?(?:-[A-Z]{2,3})?$"
                      },
                      "appInstanceId": {
                        "description": "An id specific to a user device",
                        "type": "string",
                        "minLength": 6
                      },
                      "opaqueId": {
                        "description": "Typically the hash of the identityId",
                        "type": "string",
                        "pattern": "^[0-9abcdefABCDEF]+$"
                      },
                      "clientId": {
                        "description": "An id indicating the source of the client",
                        "type": "string",
                        "enum": [
                          "whim",
                          "wechat"
                        ]
                      },
                      "dob": {
                        "description": "The customer's date of birth or boolean indicating if the value is already in DB",
                        "anyOf": [
                          {
                            "type": "boolean"
                          },
                          {
                            "description": "A date in the form YYYY-MM-DD without a time component",
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}"
                          }
                        ]
                      },
                      "ssid": {
                        "description": "Social Security ID",
                        "anyOf": [
                          {
                            "type": "boolean"
                          },
                          {
                            "description": "Social Security ID",
                            "type": "string",
                            "minLength": 4
                          }
                        ]
                      },
                      "balances": {
                        "type": "object",
                        "properties": {
                          "WMP": {
                            "type": "object",
                            "properties": {
                              "currency": {
                                "const": "WMP"
                              },
                              "amount": {
                                "type": "integer",
                                "minimum": 0
                              }
                            },
                            "required": [
                              "currency",
                              "amount"
                            ],
                            "additionalProperties": true
                          }
                        },
                        "patternProperties": {
                          "^[a-z]+(-[a-z]+)*-[a-z0-9_]+$": {
                            "type": "object",
                            "description": "key would typically match tokenId",
                            "properties": {
                              "currency": {
                                "const": "TOKEN"
                              },
                              "tokenId": {
                                "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares/items/definitions/tokenId"
                              },
                              "amount": {
                                "type": [
                                  "integer",
                                  "null"
                                ],
                                "minimum": 0
                              }
                            },
                            "required": [
                              "currency",
                              "tokenId",
                              "amount"
                            ],
                            "additionalProperties": true
                          }
                        },
                        "required": [
                          "WMP"
                        ],
                        "additionalProperties": false
                      },
                      "subscriberType": {
                        "description": "Subscriber Type",
                        "type": "string"
                      },
                      "authToken": {
                        "description": "Authentication Token",
                        "type": "string",
                        "minLength": 1,
                        "maxLength": 8192
                      }
                    },
                    "additionalProperties": false
                  },
                  "tspProduct": {
                    "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                  },
                  "configurator": {
                    "$id": "http://maasglobal.com/core/components/configurator.json",
                    "description": "Configurator schema to customize a booking option",
                    "type": "object",
                    "properties": {
                      "seatDirection": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "seatPosition": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "seatType": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "seatFeatures": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "outboundSingle": {
                        "description": "Single ticket for outwardJourney",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "inboundSingle": {
                        "description": "Single ticket for return journey, go as a pair with outboundSingle",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "openReturn": {
                        "description": "Open return ticket can be used for both outward and return journeys",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "freeReturn": {
                        "description": "Going as a pair with open return, providing options for clients to choose return journey for it's open return tickets",
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/config"
                      },
                      "ticketCollectionPoint": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/text"
                      }
                    },
                    "additionalProperties": false,
                    "definitions": {
                      "config": {
                        "type": "object",
                        "description": "A customization to the booking option",
                        "properties": {
                          "type": {
                            "description": "Describe the possible combination of choices user can make",
                            "enum": [
                              "oneOf",
                              "someOf",
                              "allOf",
                              "oneOrNoneOf",
                              "someOrNoneOf"
                            ]
                          },
                          "name": {
                            "type": "string",
                            "minLength": 0,
                            "maxLength": 255
                          },
                          "description": {
                            "type": "string"
                          },
                          "choices": {
                            "type": "array",
                            "uniqueItems": true,
                            "description": "Set of choices for one customization",
                            "items": {
                              "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator/definitions/choice"
                            }
                          }
                        },
                        "required": [
                          "type",
                          "name",
                          "choices"
                        ]
                      },
                      "choice": {
                        "type": "object",
                        "description": "A choice for one customization",
                        "properties": {
                          "id": {
                            "type": "string",
                            "minLength": 0
                          },
                          "name": {
                            "type": "string",
                            "minLength": 0,
                            "maxLength": 255
                          },
                          "description": {
                            "type": "string"
                          },
                          "default": {
                            "type": "boolean"
                          },
                          "cost": {
                            "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                          },
                          "fares": {
                            "type": "array",
                            "items": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares/items"
                            }
                          },
                          "terms": {
                            "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                          },
                          "meta": {
                            "type": "object"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "default"
                        ]
                      },
                      "text": {
                        "type": "object",
                        "description": "Generic text field to pass information from user",
                        "properties": {
                          "type": {
                            "enum": [
                              "text"
                            ]
                          },
                          "name": {
                            "type": "string",
                            "minLength": 0,
                            "maxLength": 255
                          },
                          "description": {
                            "type": "string"
                          },
                          "input": {
                            "type": "string",
                            "minLength": 0,
                            "maxLength": 8192
                          }
                        },
                        "required": [
                          "type",
                          "name"
                        ]
                      }
                    }
                  },
                  "customerSelection": {
                    "$id": "http://maasglobal.com/core/components/customerSelection.json",
                    "description": "Customer Selection for Configurator",
                    "type": "object",
                    "properties": {
                      "seatDirection": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "seatPosition": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "seatType": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "seatFeatures": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "outboundSingle": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "inboundSingle": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "openReturn": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "freeReturn": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/configChoiceSelection"
                      },
                      "ticketCollectionPoint": {
                        "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection/definitions/textInputSelection"
                      }
                    },
                    "additionalProperties": false,
                    "definitions": {
                      "configChoiceSelection": {
                        "description": "customerSelection format for configurator config type - choice",
                        "type": "array",
                        "items": {
                          "type": "string",
                          "minLength": 0,
                          "maxLength": 8192
                        }
                      },
                      "textInputSelection": {
                        "description": "customerSelection format for configurator config type - text",
                        "type": "string",
                        "minLength": 0,
                        "maxLength": 8192
                      }
                    }
                  }
                },
                "required": [
                  "leg",
                  "meta",
                  "terms",
                  "customer",
                  "tspProduct"
                ],
                "additionalProperties": true
              },
              "examples": {
                "taxi": {
                  "summary": "Taxi",
                  "externalValue": "../examples/taxi/booking-create-request.json"
                }
              }
            }
          },
          "description": "Parameters of booking to be created, optionally referencing \nofferId returned on the `/bookings/options` call.\n",
          "required": true
        },
        "responses": {
          "200": {
            "x-summary": "Booking",
            "description": "Booking information\n",
            "content": {
              "application/json": {
                "schema": {
                  "$id": "http://maasglobal.com/tsp/bookings-create/response.json",
                  "description": "Response schema for creating a booking through a TSP adapter",
                  "type": "object",
                  "properties": {
                    "tspId": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
                    },
                    "state": {
                      "$ref": "#/paths/~1backend~1booking~1%7BtspId%7D/patch/requestBody/content/application~1json/schema/properties/state"
                    },
                    "cost": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                    },
                    "leg": {
                      "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/leg"
                    },
                    "meta": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta"
                    },
                    "terms": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                    },
                    "token": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/token"
                    },
                    "tspProduct": {
                      "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                    },
                    "configurator": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator"
                    },
                    "customerSelection": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection"
                    },
                    "customer": {
                      "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/customer"
                    }
                  },
                  "required": [
                    "tspId",
                    "state",
                    "meta",
                    "terms",
                    "token",
                    "tspProduct"
                  ],
                  "additionalProperties": false
                },
                "examples": {
                  "Taxi": {
                    "summary": "Taxi",
                    "externalValue": "../examples/taxi/booking-create-response.json"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/bookings/{tspId}": {
      "get": {
        "operationId": "bookingGet",
        "summary": "Get booking",
        "description": "Returns the Booking that has been created earlier",
        "tags": [
          "Booking"
        ],
        "parameters": [
          {
            "name": "tspId",
            "description": "ID of the booking created earlier",
            "in": "path",
            "required": true,
            "schema": {
              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "The booking matching the query",
            "content": {
              "application/json": {
                "schema": {
                  "$id": "http://maasglobal.com/core/booking.json",
                  "type": "object",
                  "description": "The base booking object with all fields, to be inherited",
                  "properties": {
                    "id": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/id"
                    },
                    "tspId": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
                    },
                    "state": {
                      "$ref": "#/paths/~1backend~1booking~1%7BtspId%7D/patch/requestBody/content/application~1json/schema/properties/state"
                    },
                    "stateLog": {
                      "$id": "http://maasglobal.com/core/components/state-log.json",
                      "description": "Set of booking state transitions",
                      "type": "array",
                      "items": {
                        "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/properties/stateLog/definitions/bookingStateTransition"
                      },
                      "definitions": {
                        "obsoleteTime": {
                          "type": "string",
                          "pattern": "^[0-9]+$"
                        },
                        "bookingStateTransition": {
                          "type": "object",
                          "properties": {
                            "timestamp": {
                              "anyOf": [
                                {
                                  "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                                },
                                {
                                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/properties/stateLog/definitions/obsoleteTime"
                                }
                              ]
                            },
                            "oldState": {
                              "$ref": "#/paths/~1backend~1booking~1%7BtspId%7D/patch/requestBody/content/application~1json/schema/properties/state"
                            },
                            "newState": {
                              "$ref": "#/paths/~1backend~1booking~1%7BtspId%7D/patch/requestBody/content/application~1json/schema/properties/state"
                            },
                            "invalid": {
                              "type": "boolean"
                            },
                            "reason": {
                              "type": "object",
                              "properties": {
                                "text": {
                                  "type": "string"
                                },
                                "errorCode": {
                                  "type": "number"
                                }
                              },
                              "additionalProperties": true
                            }
                          },
                          "required": [
                            "newState",
                            "oldState",
                            "timestamp"
                          ],
                          "additionalProperties": true
                        }
                      }
                    },
                    "fares": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares"
                    },
                    "cost": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                    },
                    "leg": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/leg"
                    },
                    "token": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/token"
                    },
                    "meta": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta"
                    },
                    "terms": {
                      "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                    },
                    "customer": {
                      "description": "MaaS booking customer",
                      "allOf": [
                        {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customer"
                        },
                        {
                          "required": [
                            "identityId"
                          ]
                        }
                      ]
                    },
                    "product": {
                      "$id": "http://maasglobal.com/core/product.json",
                      "description": "Product in core which encapsulates at least an id, name and a tspProductId",
                      "type": "object",
                      "properties": {
                        "id": {
                          "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/properties/product/definitions/id"
                        },
                        "name": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "description": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "icon": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "priority": {
                          "type": "integer",
                          "minimum": 0
                        },
                        "agencyId": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/agencyId"
                        },
                        "tspProductId": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "allowFinishTrip": {
                          "type": "boolean"
                        }
                      },
                      "definitions": {
                        "id": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        }
                      },
                      "required": [
                        "id",
                        "tspProductId",
                        "name"
                      ]
                    },
                    "signature": {
                      "description": "Signature of a signed object",
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 1024
                    },
                    "configurator": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator"
                    },
                    "customerSelection": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/customerSelection"
                    }
                  },
                  "required": [
                    "id",
                    "state",
                    "leg",
                    "meta",
                    "terms",
                    "token",
                    "customer"
                  ],
                  "definitions": {
                    "id": {
                      "description": "Universally unique identifier, see https://en.wikipedia.org/wiki/Universally_unique_identifier",
                      "type": "string",
                      "pattern": "^[A-Fa-f0-9]{8}(-[A-Fa-f0-9]{4}){3}-[A-Fa-f0-9]{12}$"
                    },
                    "fares": {
                      "type": "array",
                      "items": {
                        "$id": "http://maasglobal.com/core/components/fare.json",
                        "description": "A fare/price as billed to the user in WMPs or in tokens",
                        "type": "object",
                        "definitions": {
                          "tokenId": {
                            "type": "string",
                            "pattern": "^[a-z]+(-[a-z]+)*-[a-z0-9_]+$"
                          }
                        },
                        "properties": {
                          "amount": {
                            "type": [
                              "integer",
                              "null"
                            ],
                            "minimum": 0
                          },
                          "currency": {
                            "type": "string",
                            "enum": [
                              "WMP",
                              "TOKEN"
                            ]
                          },
                          "tokenId": {
                            "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares/items/definitions/tokenId"
                          },
                          "originalAmount": {
                            "type": [
                              "integer",
                              "null"
                            ],
                            "minimum": 0
                          },
                          "productionAmount": {
                            "type": [
                              "integer",
                              "null"
                            ],
                            "minimum": 0
                          },
                          "type": {
                            "type": "string",
                            "enum": [
                              "charge",
                              "refund"
                            ]
                          }
                        },
                        "required": [
                          "amount",
                          "currency"
                        ],
                        "additionalProperties": false
                      }
                    },
                    "cost": {
                      "$id": "http://maasglobal.com/core/components/cost.json",
                      "description": "MaaS common units that are used consistently within our own objects",
                      "type": "object",
                      "properties": {
                        "amount": {
                          "type": [
                            "number",
                            "null"
                          ],
                          "minimum": 0,
                          "multipleOf": 0.01
                        },
                        "originalAmount": {
                          "type": [
                            "number",
                            "null"
                          ],
                          "minimum": 0,
                          "multipleOf": 0.01
                        },
                        "discount": {
                          "type": "number",
                          "minimum": 0,
                          "multipleOf": 0.01
                        },
                        "taxes": {
                          "type": "number",
                          "minimum": 0,
                          "multipleOf": 0.01
                        },
                        "currency": {
                          "oneOf": [
                            {
                              "description": "Accepted monetary unit in ISO 4127 format, see https://en.wikipedia.org/wiki/ISO_4217#cite_note-1",
                              "type": "string",
                              "enum": [
                                "EUR",
                                "GBP",
                                "SGD",
                                "USD",
                                "JPY"
                              ]
                            },
                            {
                              "type": "null"
                            }
                          ]
                        }
                      },
                      "required": [
                        "amount",
                        "currency"
                      ],
                      "additionalProperties": false
                    },
                    "configurator": {
                      "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/configurator"
                    },
                    "tspId": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 256
                    },
                    "leg": {
                      "type": "object",
                      "description": "MaaS response may return any subset of legCore",
                      "properties": {
                        "signature": {
                          "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/properties/signature"
                        },
                        "state": {
                          "description": "The life-cycle state of a leg",
                          "type": "string",
                          "enum": [
                            "START",
                            "PLANNED",
                            "PAID",
                            "ACTIVATED",
                            "CANCELLED",
                            "FINISHED"
                          ]
                        },
                        "from": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                        },
                        "to": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                        },
                        "startTime": {
                          "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                        },
                        "endTime": {
                          "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                        },
                        "mode": {
                          "anyOf": [
                            {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/personalMode"
                            },
                            {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/publicTransitMode"
                            },
                            {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/4/schema/definitions/privateTransitMode"
                            }
                          ]
                        },
                        "stops": {
                          "type": "array",
                          "items": {
                            "$id": "http://maasglobal.com/core/stop.json",
                            "allOf": [
                              {
                                "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/to"
                              },
                              {
                                "type": "object",
                                "properties": {
                                  "startTime": {
                                    "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "departureDelay": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/departureDelay"
                        },
                        "arrivalDelay": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/departureDelay"
                        },
                        "distance": {
                          "description": "Distance in meters",
                          "type": "number",
                          "minimum": 0,
                          "maximum": 40075000,
                          "multipleOf": 1
                        },
                        "route": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "routeShortName": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 64
                        },
                        "routeLongName": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 255
                        },
                        "agencyId": {
                          "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/leg/properties/agencyId"
                        },
                        "legGeometry": {
                          "type": "object",
                          "properties": {
                            "points": {
                              "type": "string",
                              "description": "Google encoded polyline, see: https://developers.google.com/maps/documentation/utilities/polylinealgorithm",
                              "minLength": 3,
                              "maxLength": 65535,
                              "pattern": "^([\\x5F-\\x7E]*[\\x3F-\\x5E])+$"
                            }
                          }
                        },
                        "tspProduct": {
                          "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                        },
                        "productOption": {
                          "description": "Index of the productOption used in the itinerary's productOptions",
                          "type": "integer",
                          "minimum": 0
                        }
                      },
                      "additionalProperties": false
                    },
                    "terms": {
                      "$id": "http://maasglobal.com/core/components/terms.json",
                      "description": "MaaS booking terms and condition for its business engine",
                      "type": "object",
                      "properties": {
                        "type": {
                          "description": "A type of ticket/product that this booking is valid for - should be unique within a given region, e.g. 'Single ticket / Lähiseutu 2'. When reusing the tickets in maas-backend, the 'type' field is checked for equality.",
                          "type": "string",
                          "minLength": 0,
                          "maxLength": 64
                        },
                        "seatings": {
                          "description": "In 1 booking for a journey, it can be valid for many of the journey's leg. Each item of seating is a seat on 1 specific route",
                          "type": "array",
                          "items": {
                            "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms/definitions/seat"
                          }
                        },
                        "validity": {
                          "description": "Booking validity conditions",
                          "type": "object",
                          "properties": {
                            "startTime": {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema",
                              "description": "Epoch when the outbound ticket will be valid"
                            },
                            "endTime": {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema",
                              "description": "Epoch when the outbound ticket will be invalid"
                            },
                            "startTimeReturn": {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema",
                              "description": "Epoch when the return ticket will be valid"
                            },
                            "endTimeReturn": {
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema",
                              "description": "Epoch when the return ticket will be invalid"
                            }
                          },
                          "required": [
                            "startTime",
                            "endTime"
                          ]
                        },
                        "reusable": {
                          "type": "boolean",
                          "description": "A flag indicating whether this booking can be reused for another trip within the validity period"
                        },
                        "reconcilable": {
                          "type": "boolean",
                          "description": "A flag indicating whether this booking will be reconciled once the trip has finished"
                        },
                        "restrictions": {
                          "type": "object",
                          "description": "Booking restrictions",
                          "properties": {
                            "singleDevice": {
                              "type": "boolean",
                              "description": "A flag indicating whether this booking can be viewed in multiple devices at the same time"
                            },
                            "skipRestrictionCheck": {
                              "type": "boolean",
                              "description": "A flag indicating whether restriction check should be run"
                            },
                            "freeTicket": {
                              "type": "object",
                              "description": "A JSON schema object which defines restriction rules for free ticket"
                            }
                          }
                        },
                        "cancellation": {
                          "type": "object",
                          "properties": {
                            "cancellationFormActionUrl": {
                              "description": "User will fill in this form to cancel their ticket should programmed cancellation does not function. Edge case support",
                              "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta/properties/MODE_TAXI/properties/driver/properties/image"
                            },
                            "outward": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms/definitions/cancellation"
                            },
                            "return": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms/definitions/cancellation"
                            }
                          }
                        },
                        "amendment": {
                          "type": "object",
                          "properties": {
                            "outward": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms/definitions/amendment"
                            },
                            "return": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms/definitions/amendment"
                            }
                          }
                        },
                        "fareRates": {
                          "type": "array",
                          "items": {
                            "description": "Booking fare rate",
                            "type": "object",
                            "properties": {
                              "amount": {
                                "type": "number",
                                "minimum": 0,
                                "multipleOf": 0.01
                              },
                              "currency": {
                                "$ref": "#/paths/~1backend~1booking~1%7BtspId%7D/patch/requestBody/content/application~1json/schema/properties/cost/properties/currency/oneOf/0"
                              },
                              "timeInterval": {
                                "description": "Amount of seconds that fare rate is applied to",
                                "type": "number",
                                "minimum": 1,
                                "multipleOf": 1
                              },
                              "startAt": {
                                "description": "Amount of seconds after this fare rate should be applied to",
                                "type": "number",
                                "minimum": 0,
                                "multipleOf": 1
                              },
                              "type": {
                                "enum": [
                                  "maxRate",
                                  "missedReturnPenalty",
                                  "extra"
                                ]
                              }
                            },
                            "required": [
                              "amount",
                              "currency"
                            ]
                          }
                        }
                      },
                      "additionalProperties": true,
                      "definitions": {
                        "seat": {
                          "description": "Ticket's seat information for long distance trains, coaches or flights",
                          "type": "object",
                          "properties": {
                            "route": {
                              "description": "The leg's route number that this seat info belongs",
                              "type": "string",
                              "minLength": 1,
                              "maxLength": 255
                            },
                            "number": {
                              "type": [
                                "string",
                                "number"
                              ]
                            },
                            "coach": {
                              "type": [
                                "string",
                                "number"
                              ]
                            }
                          }
                        },
                        "cancellation": {
                          "type": "object",
                          "properties": {
                            "cancellable": {
                              "type": "boolean",
                              "description": "A flag indicating whether this booking can be cancelled in 'RESERVED' state"
                            },
                            "cost": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                            },
                            "fare": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares/items"
                            },
                            "refunded": {
                              "type": "boolean",
                              "description": "Whether this part of the booking has been refunded"
                            }
                          },
                          "required": [
                            "cancellable",
                            "refunded"
                          ]
                        },
                        "amendment": {
                          "type": "object",
                          "properties": {
                            "amendable": {
                              "type": "boolean",
                              "description": "A flag indicating whether this booking can be amended"
                            },
                            "cost": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                            },
                            "fare": {
                              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/fares/items"
                            }
                          },
                          "required": [
                            "amendable"
                          ]
                        }
                      }
                    },
                    "token": {
                      "description": "The validity token (such as booking ID, travel ticket etc.) that MaaS clients will display to validate the trip when starting the leg.",
                      "type": "object",
                      "properties": {
                        "validityDuration": {
                          "description": "The rules that MaaS will interpret to schedule, re-validate or cancel the booking.",
                          "type": "object",
                          "properties": {
                            "startTime": {
                              "description": "The starting time from which the ticket is valid",
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                            },
                            "endTime": {
                              "description": "The finishing time the ticket is valid for",
                              "$ref": "#/paths/~1bookings~1options/get/parameters/2/schema"
                            }
                          }
                        },
                        "data": {
                          "description": "Arbitrary ticket data for the client",
                          "type": "object"
                        },
                        "meta": {
                          "description": "Arbitrary metadata the TSP may pass along the ticket to the client (e.g. a booking code, base64 encoded binary)",
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "Taxi1": {
                    "summary": "Taxi - RESERVED",
                    "externalValue": "../examples/taxi/booking-read-by-id-response.json"
                  },
                  "Taxi2": {
                    "summary": "Taxi - ACTIVATED",
                    "externalValue": "../examples/taxi/booking-read-by-id-response-activated.json"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request (invalid query parameters)",
            "content": {
              "application/json": {
                "schema": {
                  "$id": "http://maasglobal.com/core/error.json",
                  "description": "An error that the service may send",
                  "type": "object",
                  "required": [
                    "message",
                    "code"
                  ],
                  "properties": {
                    "message": {
                      "type": "string",
                      "description": "A human readable error message (preferrably in English)",
                      "minLength": 1,
                      "maxLength": 256
                    },
                    "code": {
                      "type": "string",
                      "description": "An internal error code, used for reference",
                      "minLength": 1,
                      "maxLength": 64
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authorization error (invalid API key)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "default": {
            "description": "unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          }
        }
      },
      "patch": {
        "operationId": "bookingUpdate",
        "summary": "Update booking",
        "description": "Update booking, chaning state or changing booking details.\n",
        "tags": [
          "Booking"
        ],
        "parameters": [
          {
            "name": "tspId",
            "description": "ID of the booking created earlier",
            "in": "path",
            "required": true,
            "schema": {
              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated, old booking returned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema"
                }
              }
            }
          },
          "204": {
            "description": "Updated, no content returned"
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "401": {
            "description": "Authorization error (invalid API key)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "default": {
            "description": "unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          }
        }
      },
      "delete": {
        "operationId": "bookingCancel",
        "summary": "Cancel booking",
        "description": "Cancel booking if it is possible.\n\nCancel can be a subject to a fee, as returned by 200 OK response to this method.\n",
        "tags": [
          "Booking"
        ],
        "parameters": [
          {
            "name": "tspId",
            "description": "ID of the booking created earlier",
            "in": "path",
            "required": true,
            "schema": {
              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted, old booking returned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema"
                }
              }
            }
          },
          "204": {
            "description": "Deleted, no content returned"
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "401": {
            "description": "Authorization error (invalid API key)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "403": {
            "description": "Cancellation forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "default": {
            "description": "unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          }
        }
      }
    },
    "/bookings/{tspId}/receipt": {
      "get": {
        "operationId": "bookingGetReceipt",
        "summary": "Get final booking receipt",
        "description": "Get finalized pricing and receipt for booking\n",
        "tags": [
          "Booking"
        ],
        "parameters": [
          {
            "name": "tspId",
            "description": "ID of the booking created earlier",
            "in": "path",
            "required": true,
            "schema": {
              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "The bookings matching the query",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema"
                }
              }
            }
          },
          "400": {
            "description": "Bad request (invalid query parameters)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "401": {
            "description": "Authorization error (invalid API key)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "404": {
            "description": "Receipt not ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          },
          "default": {
            "description": "unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          }
        }
      }
    },
    "/backend/booking/{tspId}": {
      "patch": {
        "operationId": "backendBookingReceive",
        "summary": "Update booking state",
        "description": "Updates booking information at the WhimApp backend. \n\nCalled by TSP whenever the state of the booking are updated.\n",
        "parameters": [
          {
            "name": "tspId",
            "description": "ID of the booking created earlier",
            "in": "path",
            "required": true,
            "schema": {
              "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
            }
          }
        ],
        "tags": [
          "WebHook"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$id": "http://maasglobal.com/tsp/bookings-read-by-id/response.json",
                "description": "Response schema for getting a specific booking with a TSP ID from a TSP adapter",
                "properties": {
                  "tspId": {
                    "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/tspId"
                  },
                  "cost": {
                    "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/cost"
                  },
                  "state": {
                    "description": "The life-cycle state of a booking",
                    "type": "string",
                    "enum": [
                      "START",
                      "PENDING",
                      "PAID",
                      "RESERVED",
                      "CONFIRMED",
                      "ARRIVED",
                      "ACTIVATED",
                      "ON_HOLD",
                      "CANCELLED",
                      "EXPIRED",
                      "REJECTED",
                      "FINISHED",
                      "UNKNOWN"
                    ]
                  },
                  "leg": {
                    "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/legDelta"
                  },
                  "meta": {
                    "$ref": "#/paths/~1bookings/post/requestBody/content/application~1json/schema/properties/meta"
                  },
                  "terms": {
                    "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/terms"
                  },
                  "token": {
                    "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/200/content/application~1json/schema/definitions/token"
                  },
                  "tspProduct": {
                    "$ref": "#/paths/~1bookings~1options/get/responses/200/content/application~1json/schema/properties/options/items/definitions/tspProduct"
                  }
                },
                "required": [
                  "tspId",
                  "state"
                ],
                "additionalProperties": false
              },
              "examples": {
                "Taxi": {
                  "summary": "Taxi",
                  "externalValue": "../examples/taxi/booking-read-by-id-response-activated.json"
                }
              }
            }
          },
          "description": "Booking information with updated state.\n",
          "required": true
        },
        "responses": {
          "204": {
            "x-summary": "Acknowledged",
            "description": "Received, no state.\n"
          },
          "400": {
            "description": "Bad request (data failed validation)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/paths/~1bookings~1%7BtspId%7D/get/responses/400/content/application~1json/schema"
                }
              }
            }
          }
        }
      }
    }
  }
}